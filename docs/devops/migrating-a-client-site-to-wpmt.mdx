---
title: Migrating to WPMT
slug: migrating-to-wpmt
sidebar_position: 10
---

# Migrating from WordPress Multisite to WordPress Multitenancy

Migrating from Multisite (WPMU) to Multitenancy (WPMT) is a delicate process. This is a very specific process that must be followed exactly to make sure nothing goes wrong. Whenever possible, we will use wp-cli to keep things as efficient as possible.

## Build a Fresh Single Installation

### 1. Build a Staging Site on a Development Server in GridPane

https://my.gridpane.com/sites

- Server: development
- System User: Autocreate new user
- WP Users: GridPane Default WP Admin Only
- Bundles: None
- PHP Version: 7.4
- PHP Process Management: Dynamic
- Server Caching: Redis Object & Page
- WAF: 7G
- SMTP Integration: Sendgrid
- SSL: AutoSSL
- DNS API Integration: Cloudflare
- Local Backups: Daily
- Remote Backups: Weekly
- Git Integration: digitalchurch-wordpress
- Git Branch: main

### 2. Activate All-in-One WP Migration & Prep Directories

```bash
gp wp {{site.url}} plugin activate all-in-one-wp-migration;
gp wp {{site.url}} plugin activate all-in-one-wp-migration-multisite-extension;
mkdir ~/www/{{site.url}}/htdocs/wp-content/ai1wm-backups/;
chmod 0777 ~/www/{{site.url}}/htdocs/wp-content/ai1wm-backups/;
chmod 0777 ~/www/{{site.url}}/htdocs/wp-content/plugins/all-in-one-wp-migration/storage/
```

### 3. Move the backup to the new single site install

Move the backup file to the new single site install via FTP.

### 4. Restore the backup into the single Installation

Login to the staging site by changing your hosts file. Restore the backup. Alternatively, you can use the commands below to restore via SSH.

```bash
gp wp {{site.url}} ai1wm list-backups
gp wp {{site.url}} ai1wm list-backups
```

Then copy the backup name and restore it with this command.

```bash
gp wp {{site.url}} ai1wm restore {{backup-name}}
gp wp {{site.url}} ai1wm restore {{backup-name}}
```

## Migrate the Database using All-in-One WP Migration

### 1. Put the source multisite site in Multisite Maintenance Mode

The wp-cli command below will activate the Multisite Maintenance Mode plugin. Be sure to replace the `{site.url}` with the domain of the site you are moving.

```bash
gp wp digitalchurch.app plugin activate multisite-maintenance-mode --url={site.url}
```

### 2. Disable the CDN Rewriting from Perfmatters

Visit: `https://site.url/wp-admin/options-general.php?page=perfmatters#cdn`

### 3. Use WP All-in-One Migration to backup site

```bash
gp wp digitalchurch.app ai1wm backup --exclude-inactive-themes --exclude-muplugins --exclude-plugins --exclude-inactive-plugins --exclude-cache --sites={site.url}
```

## Migrate the Files via GoodSync

### 1. Setup a GoodSync job 

Sync all files from the `/wp-content/uploads/sites/{{id}}/` directory on the multisite to the `/wp-content/uploads/` directory on the staging installation.

### 2. Exclude folders that contain cache or unused files.

Only include the upload directories that are year numbers.

## Clone from Staging to WPMT

### 1. In GridPane, access the single installation site editor.

### 2. in the clone tab, clone the site to the WPMT server.

You can watch the clone progress using the GP Clone Log from the source staging site.

### 3. Check active plugins on new server

Run this command on the source multisite to see what plugins are active on that site.

```bash
gp wp digitalchurch.app plugin list --status=active,active-network --format=csv --fields=name --url={{site.url}}
```

Then run this command on the multitenant install to see if the activate the same plugins.
```bash
gp wp {{site.url}} plugin activate {{paste-list-here}}
```

Tip: You can use AI to build the new command like this:

```
can you write a gridpane wp-cli command like this, but adding in the list of plugins I need to paste? The site.url is sconaz.org
gp wp {{site.url}} plugin activate {{space-separated-list-here}}
```

### 4. Change your hosts file to check the site and finish setup.

- Go to Settings > Beaver Builder and set up the white labeling. `/wp-content/mu-plugins/admin/assets/DigitalChurchFavicon.svg`
- Setup SMTP via Postmark
- Run tests on new installation

### 5. Change the DNS and Issue an SSL Certificate

## Post-Migration Testing

### 1. Beaver Builder

Make sure the branding settings are set as outlined here: [Beaver Builder Branding](/wordpress/plugins/beaver-builder/branding)   
`/wp-content/mu-plugins/admin/assets/DigitalChurchFavicon.svg`

### 2. Fluent SMTP

Make sure the client domain is added as a sending address in Postmark and working in FluentSMTP.

### 3. Update Airtable to Put Workspace on the Correct Server